---
slug: How to use caching to improve performance
title: 如何利用缓存提升性能
date: 2021-12-24
tags: [Redis,Java]
authors: Clamber
keywords: [Redis,Java]
description: 如何利用缓存提升性能
---
<!-- truncate -->
# 缓存是提升性能最直接的方法

多级缓存分为：客户端，应用层，服务层，数据层

## 客户端缓存：主要对浏览器的静态资源进行缓存

通过在浏览器设置Expires，时间段内以文件形式把图片保存在本地，减少多次请求静态资源带来的带宽损耗（解决并发手段）

## 应用层缓存： 
浏览器只负责读取Expires，Expires在CDN内容分发网络和Nginx进行设置

CDN内容分发网络是静态资源分发的主要技术手段，有效解决带宽集中占用以及数据分发问

## CDN的核心技术：
根据请求访问DNS节点， 自动转发到上海CDN节点，检查资源是否被缓存，若已缓存则返回资源否则回源北京提取到并缓存到上海CDN节点，再由上海CDN节点进行返回。

## 响应头Expires和Cache-control的区别：
1. 均为通知浏览器进行文件缓存
2. Expires指在这个时间点缓存就到期
3. Cache-control指缓存时间有多长
即：你明天还钱给我Expires，时间是一天Cache-control

# Nginx缓存管理：
Nginx对Tomcat集群做软负载均衡，提供高可用性。有静态资源缓存和压缩功能（在本地缓存文件）

服务层缓存：进程内缓存和进程外缓存
进程内缓存：即数据运行时载入程序开辟的缓存中JAVA框架的运用（hibernate，mybatis一二级缓存，springmvc页面缓存）
开源实现：ehcache，Caffeine

## 进程外缓存：即为分布式缓存（redis）
常见的加缓存是直接加redis是不严谨
需要按照：先近到远，先快后慢逐级访问
场景：商品秒杀，若无本地缓存，都保存在redis 每完成一笔交易，局域网会进行若干网络通信，可能存在网络异常不稳定因素
且redis会承担所有节点的压力，当突发流量若超过容载上限redis会崩溃
所有java的应用端也需要设计多级缓存

一般会通过进程内缓存和进程外缓存（分布式缓存）组合分担压力
ehcache（进程内缓存）可以在缓存不存在时去redis进程外缓存进行读取，redis没有读取数据库 数据库再对ehcache，redis进行更新

## 缓存一致性处理：
场景：修改商品价格为80，如何保证缓存也进行更新
处理方法：引入消息队列（MQ）的主动推送功能，对服务实例推送变更实例
即：修改商品价格为80，向MQ发送变更消息，MQ将消息推送到服务实例服务实例将原缓存数据删除，再创建缓存

## 什么情况适用多级缓存架构
1. 缓存数据稳定
2. 可能产生高并发场景（12306）应用启动时进行预热处理，访问前将热点数据先缓存，减少后端压力
3. 一定程度上允许数据不一致不重要的信息更新处理方式：日终处理

